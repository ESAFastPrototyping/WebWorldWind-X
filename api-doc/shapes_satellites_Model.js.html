<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: shapes/satellites/Model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: shapes/satellites/Model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import WorldWind from 'webworldwind-esa';

const {
    ColladaScene,
    Matrix,
    Renderable
} = WorldWind;

/**
 * @exports Model
 */
class Model extends Renderable {
    /**
     * Constructs model of the satellite on the given position.
     * @param model {Object} Model information. Collada information.
     * @param satellite {Object} The details about the satellite and the way it should be transformed and presented.
     * @param position {Position} The exact position of the center of the satellite.
     */
    constructor(model, satellite, position) {
        super();

        this._satellite = satellite;
        const satelliteModel = this.parse(model);
        this.draw(position, satelliteModel);
    }

    /**
     * Updates the position of the model.
     * @param position {Position} Current position of the model.
     */
    position(position) {
        this._model.position = position;
    }

    /**
     * Draws the collada model into a Collada Scene.
     * @param position {Position} Position of the satellite.
     * @param modelData Collada Model Information.
     */
    draw(position, modelData) {
        const nodesToHide = [
            'PlatformCircleAndName', 'SolarWingsCircleAndName', 'C-SarCircleAndName',
            'PlatformTextsAndArrows', 'SolarWingsTextsAndArrows', 'C-SarTextsAndArrows',

            'SolarArrayGroup', 'WingsDetailsGroup', 'Group004', 'MsiGroup', 'SatteliteGroup',

            'SatteliteDimensionsGroup', 'MWRGroup', 'SRALGroup', 'OLCIGroup', 'SLSTRGroup'
        ];
        const {
            rotations,
            translations,
            preRotations,
            scale,
            shortName,
            ignoreLocalTransforms
        } = this._satellite;

        const model = new ColladaScene(position, modelData);
        model.type = this.type;
        model.satShortName = shortName;

        model.nodesToHide = nodesToHide;
        model.hideNodes = true;
        model.useTexturePaths = false;
        model.localTransforms = ignoreLocalTransforms;
        model.scale = scale;
        model.xRotation = rotations.x;
        model.yRotation = rotations.y;
        model.zRotation = rotations.z;
        model.xTranslation = translations.x;
        model.yTranslation = translations.y;
        model.zTranslation = translations.z;
        model.preX = preRotations.x;
        model.preY = preRotations.y;
        model.preZ = preRotations.z;

        this._model = model;
        modelData = null;
    }

    /**
     * Parses the collada model and update the information relevant to the satellites.
     * @param {{ meshes:Object, root:Object, materials:{reflective:Array, diffuse:Array} }} jsonData
     * @return {Object} Collada model.
     */
    parse(jsonData) {
        const meshes = jsonData.meshes;
        const nodes = jsonData.root.children;
        const materials = jsonData.materials;

        for (let key in meshes) {
            if (meshes.hasOwnProperty(key)) {
                const buffers = meshes[key].buffers;

                for (let i = 0; i &lt; buffers.length; i++) {
                    const vertices = buffers[i].vertices || [];
                    const normals = buffers[i].normals || [];
                    const uvs = buffers[i].uvs || [];
                    const indices = buffers[i].indices || [];

                    const eVertices = new Float32Array(vertices);
                    const eNormals = new Float32Array(normals);
                    const eUvs = new Float32Array(uvs);
                    const eIndices = new Uint16Array(indices);

                    buffers[i].vertices = eVertices;
                    buffers[i].normals = eNormals;
                    buffers[i].uvs = eUvs;
                    buffers[i].indices = eIndices;
                }
            }
        }

        for (let i = 0; i &lt; nodes.length; i++) {
            const node = nodes[i];
            if (node.mesh) {
                const worldMatrix = node.worldMatrix.slice(0);
                node.worldMatrix = Matrix.fromIdentity();
                node.worldMatrix.copy(worldMatrix);

                if (node.children.length) {
                    console.info('node has children', node);
                }
            }
        }

        for (let key in materials) {
            if (materials.hasOwnProperty(key)) {
                const material = materials[key];

                if (material.id === '_3_-_Default-material') {
                    if (material.reflective) {
                        material.reflective[0] = 0.289219;
                        material.reflective[1] = 0.713497;
                        material.reflective[2] = 0.870753;
                        material.reflective[3] = 1;
                    }
                } else if (material.id === '_1_-_Default_004-material') {
                    material.diffuse[3] = 0;
                } else if (material.id === '_1_-_Default-material') {
                    material.diffuse[3] = 0;
                } else if (material.id === 'Chrome-material') {
                    material.textures = null;
                    material.diffuse[0] = 0.3137;
                    material.diffuse[1] = 0.3137;
                    material.diffuse[2] = 0.3137;
                } else if (material.id === 'Satellite_panel-material') {
                    material.textures.reflective.mapId = 'image9';
                } else if (material.id === '_3_-_Default') {
                    material.textures.reflective.mapId = 'image4';
                } else if (material.id === '_4_-_Default-material') {
                    material.textures.reflective.mapId = 'image5';
                } else if (material.id === '_5_-_Default_002-material') {
                    material.textures.reflective.mapId = 'image6';
                } else if (material.id === '_5_-_Default-material') {
                    material.textures.reflective.mapId = 'image5';
                }
            }
        }

        return jsonData;
    }

    /**
     * @inheritDoc
     */
    render(dc) {
        if(!this._model || !this.enabled) {
            return;
        }

        this._model.render(dc);
    }
}

export default Model;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-SunPosition.html">SunPosition</a></li></ul><h3>Classes</h3><ul><li><a href="AcquisitionPlans.html">AcquisitionPlans</a></li><li><a href="AcquisitionPlansCache.html">AcquisitionPlansCache</a></li><li><a href="AcquisitionPlansParser.html">AcquisitionPlansParser</a></li><li><a href="Controls.html">Controls</a></li><li><a href="KmlGroundOverlayFull.html">KmlGroundOverlayFull</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="module-CyclicPickController.html">CyclicPickController</a></li><li><a href="module-LayerOrder.html">LayerOrder</a></li><li><a href="module-Model.html">Model</a></li><li><a href="module-Orbits.html">Orbits</a></li><li><a href="module-TexturedSurfacePolygon.html">TexturedSurfacePolygon</a></li><li><a href="StarFieldLayer.html">StarFieldLayer</a></li><li><a href="StarFieldProgram.html">StarFieldProgram</a></li><li><a href="SwathCone.html">SwathCone</a></li><li><a href="TexturedSurfaceShape.html">TexturedSurfaceShape</a></li><li><a href="WebWorker.html">WebWorker</a></li><li><a href="Workers.html">Workers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#footprintAttributes">footprintAttributes</a></li><li><a href="global.html#icon">icon</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#metadata">metadata</a></li><li><a href="global.html#products">products</a></li><li><a href="global.html#renderable">renderable</a></li><li><a href="global.html#renderables">renderables</a></li><li><a href="global.html#topocentricToLookAngles">topocentricToLookAngles</a></li><li><a href="global.html#twoline2satrec">twoline2satrec</a></li><li><a href="global.html#url">url</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Nov 29 2019 13:54:07 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
