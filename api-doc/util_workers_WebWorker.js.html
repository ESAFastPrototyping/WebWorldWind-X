<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: util/workers/WebWorker.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: util/workers/WebWorker.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>export class WebWorker {

    /**
     * @alias WebWorker
     * @constructor
     * @param {*} Loader a webpack worker-loader
     * @param {Function} onMessage 
     * @param {Function} onError 
     */
    constructor(Loader, onMessage, onError) {
        this.Loader = Loader;
        
        this.inProgress = false;
        
        this.workId = null;
        
        this.worker = null;

        this.terminateTimeout = null;

        this.onMessage = this.onMessage.bind(this);
        this.onError = this.onError.bind(this);

        this.onMessageCallback = onMessage;
        this.onErrorCallback = onError;
    }

    /**
     * Sends data to the web worker.
     * 
     * @param {*} data 
     * @param {*} id 
     */
    postMessage(data, id) {
        if (!this.worker) {
            this.start();
        }
        this.worker.postMessage(data);
        this.inProgress = true;
        this.workId = id;
    }

    /**
     * Initializes a web worker.
     */
    start() {
        if (this.worker) {
            return;
        }
        this.worker = new this.Loader();
        this.bindEvents();
    }

    /**
    * Terminates a web worker.
    */
    stop() {
        if (this.worker) {
            if (this.inProgress) {
                this.scheduleTerminate();
                return false;
            }
            this.unbindEvents();
            this.worker.terminate();
            this.worker = null;
            this.inProgress = false;
        }
        return true;
    }

    bindEvents() {
        this.worker.addEventListener('message', this.onMessage, false);
        this.worker.addEventListener('error', this.onError, false);
    }

    unbindEvents() {
        this.worker.removeEventListener('message', this.onMessage);
        this.worker.removeEventListener('error', this.onError);
    }

    scheduleTerminate() {
        clearTimeout(this.terminateTimeout);
        this.terminateTimeout = setTimeout(() => {
            this.stop();
        }, 5000);
    }

    onMessage(e) {
        this.inProgress = false;
        this.onMessageCallback(e.data, this.workId);
    }

    onError(e) {
        this.inProgress = false;
        this.onErrorCallback(e, this.workId);
    }

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-SunPosition.html">SunPosition</a></li></ul><h3>Classes</h3><ul><li><a href="AcquisitionPlans.html">AcquisitionPlans</a></li><li><a href="AcquisitionPlansCache.html">AcquisitionPlansCache</a></li><li><a href="AcquisitionPlansParser.html">AcquisitionPlansParser</a></li><li><a href="Controls.html">Controls</a></li><li><a href="KmlGroundOverlayFull.html">KmlGroundOverlayFull</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="module-CyclicPickController.html">CyclicPickController</a></li><li><a href="module-LayerOrder.html">LayerOrder</a></li><li><a href="module-Model.html">Model</a></li><li><a href="module-Orbits.html">Orbits</a></li><li><a href="module-TexturedSurfacePolygon.html">TexturedSurfacePolygon</a></li><li><a href="StarFieldLayer.html">StarFieldLayer</a></li><li><a href="StarFieldProgram.html">StarFieldProgram</a></li><li><a href="SwathCone.html">SwathCone</a></li><li><a href="TexturedSurfaceShape.html">TexturedSurfaceShape</a></li><li><a href="WebWorker.html">WebWorker</a></li><li><a href="Workers.html">Workers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#footprintAttributes">footprintAttributes</a></li><li><a href="global.html#icon">icon</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#metadata">metadata</a></li><li><a href="global.html#products">products</a></li><li><a href="global.html#renderable">renderable</a></li><li><a href="global.html#renderables">renderables</a></li><li><a href="global.html#topocentricToLookAngles">topocentricToLookAngles</a></li><li><a href="global.html#twoline2satrec">twoline2satrec</a></li><li><a href="global.html#url">url</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Nov 29 2019 13:54:07 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
